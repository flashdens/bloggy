{% extends 'base.html.twig' %}

{% block body %}
    <div class="flex justify-center flex-col items-center py-3 md:mt-8 px-12">
        <div class="container p-3">
            {% block post %}
            <div class="my-6 md:w-3/4 text-center border">
                <small class="py-3">
                    {{ post.published|format_datetime }}
                </small>
                <h2 class="my-3">
                    {{ post.title }}
                </h2>
                {% if post.category.name is defined %}
                    <td>
                        <a type="button" class="btn btn-outline-primary"
                           href="{{ url('admin_view_category', {id: post.category.id}) }}">{{ post.category.name }}
                        </a><br>
                    </td>
                {% else %}
                    <button class="btn btn-outline-primary"> null </button>
                {% endif %}
                {% for tag in post.tags %}
                    <a type="button" class="btn btn-outline-secondary mt-2"
                       href="{{ url('admin_view_tag', {id: tag.id}) }}">{{ tag.title }}</a>
                {% endfor %}
                <section class="px-5">
                    <p class="text-center text-base font-normal ">
                        {{ post.content|markdown_to_html }}
                    </p>
                </section>
                <section class="py-3 mb-2">
                    <div class="container">
                    <img class="card-img-top mx-auto" src="{{ asset('uploads/' ~ post.image) }}" alt=""
                         style="height: 40%; width: 50%; display: block;">
                    </div>
                </section>
                {% if is_granted('ROLE_ADMIN') %}
                    <div class="border-top"></div>
                    <a type="submit" href="{{ url('admin_edit_post', {id: post.id}) }}" class="btn btn-primary m-3">{{ 'action.edit'|trans }}</a>
                    <a type="submit" href="{{ url('admin_delete_post', {id: post.id}) }}" class="btn btn-danger m-3">{{ 'action.delete'|trans }}</a>
                {% endif %}
            </div>
        </div>
        {% endblock %}
    </div>
    {% block comments %}
        <div class="container">
            {% if pagination is defined and pagination.items|length %}
            {% for comment in pagination.items %}
            <div class="d-flex flex-column justify-content-center text-center p-3 ">
                {% if comment.author.avatar.filename is defined and comment.author.avatar.filename|length %}
                    <img class="text-center mx-auto mb-3 d-md-block d-none"
                         src="{{ asset('uploads/' ~comment.author.avatar.filename) }}"
                         width="80px" height="80px" alt="">
                {% else %}
                <img
                        src="{{ asset('img/logo.png') }}"
                        class="text-center mx-auto mb-3 d-md-block d-none"
                        width="80px" height="80px"
                        alt="{{ comment.author.email }}">
                    {% endif %}
                <h4 class="text-center">
                    {{ comment.author.email }}
                </h4>
                <p class="col">
                    {{ comment.published|format_datetime }}
                </p>
                <p>
                    {{ comment.content|markdown_to_html }}
                </p>
                {% if is_granted('ROLE_ADMIN') %}
                    <div class="container">
                        <a class="btn btn-danger mb-3" type="submit"
                           href="{{ url('admin_delete_comment', {id: comment.id}) }}">
                            {{ 'action.delete'|trans }}</a>
                    </div>
                {% endif %}
                <div class="border-bottom"></div>
                {% endfor %}
                {% else %}
                    <h2 class="text-center">
                        {{ 'info.no_comments'|trans }}
                    </h2>
                {% endif %}
            </div>
        </div>
    {% endblock %}
    {% if app.user is not null %}
        <h1 class="text-center my-4"> {{ 'action.add_comment'|trans }} </h1>
        <div class="container text-center">
        {{ form_start(form) }}
                <div class="row justify-content-center text-center">
                    {{ form_widget(form) }}
                </div>
        <div class="form-group">
            <input type="submit" value="{{ 'action.submit'|trans }}" class="btn btn-primary"/>
        </div>
        <div class="form-group row float-sm-left">
            <a class="btn btn-link"
               href="{{ url('view_post', {id: post.id}) }}">
            </a>
        </div>
        </div>
        {{ form_end(form) }}
    {% else %}
        <div class="text-center mt-3">
            {{ 'info.log_in_to_comment'|trans }}
        </div>
    {% endif %}
{% endblock %}
